---
title: "React ìƒíƒœ ì—…ë°ì´íŠ¸ì™€ ë¹„ë™ê¸° ì‘ì—…: í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ì˜ ì¤‘ìš”ì„±"

excerpt: "ë¹„ë™ê¸° ì‘ì—…ì—ì„œì˜ ë°°ì¹­ ì²˜ë¦¬ ì´í•´í•˜ê¸°, í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì´ìœ "

categories:
  - React

tags:
  - [react, react19, jsx, setState, queueing, batching]

permalink: /categories/react/how-to-manage-state-in-async-function/

toc: true

toc_sticky: true

date: 2025-05-01

last_modified_at: 2025-05-01
---

## React ìƒíƒœ ì—…ë°ì´íŠ¸ì™€ ë¹„ë™ê¸° ì‘ì—…

ë¦¬ì•¡íŠ¸ ê³µì‹ë¬¸ì„œì˜ ì±Œë¦°ì§€ ë¬¸ì œë¥¼ í’€ë‹¤ê°€ ë¹„ë™ê¸° ì‘ì—…ì—ì„œ ë¦¬ì•¡íŠ¸ê°€ ë°°ì¹­ ì²˜ë¦¬ë¥¼ ì–´ë–»ê²Œ í•˜ëŠ”ì§€ ì •í™•íˆ ì´í•´ê°€ ê°€ì§€ ì•Šì•„ ì¢€ ë” ì°¾ì•„ë³´ì•˜ë‹¤.

- ë¹„ë™ê¸° ì‘ì—…ì—ì„œ ë¦¬ì•¡íŠ¸ê°€ ë°°ì¹­ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹
- ë°°ì¹­ ì²˜ë¦¬ì™€ ë¦¬ë Œë”ë§
- ê·¸ë˜ì„œ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì•ˆì „í•œ ì´ìœ 

[ì±Œë¦°ì§€ ë¬¸ì œ ë§í¬ - React v19 ê³µì‹ë¬¸ì„œ](https://ko.react.dev/learn/queueing-a-series-of-state-updates#challenges)

## ğŸš©ì±Œë¦°ì§€ : State ì—…ë°ì´íŠ¸ íì™€ ë¹„ë™ê¸° ì‘ì—…

[`ë¬¸ì œ ì½”ë“œ`] ìš”ì²­ ì¹´ìš´í„°ë¥¼ ê³ ì³ë³´ì„¸ìš”.

```jsx
import { useState } from "react";

export default function RequestTracker() {
  const [pending, setPending] = useState(0);
  const [completed, setCompleted] = useState(0);

  async function handleClick() {
    setPending(pending + 1);
    await delay(3000);
    setPending(pending - 1);
    setCompleted(completed + 1);
  }

  return (
    <>
      <h3>Pending: {pending}</h3>
      <h3>Completed: {completed}</h3>
      <button onClick={handleClick}>Buy</button>
    </>
  );
}

function delay(ms) {
  return new Promise((resolve) => {
    setTimeout(resolve, ms);
  });
}
```

- `await delay(3000)` ìœ¼ë¡œ `setPending(pending -1)`ê³¼ `setCompleted(completed + 1)` ì´ 3ì´ˆ í›„ì— ì‹¤í–‰ë˜ì§€ë§Œ ì‹¤í–‰ë˜ëŠ” ì‹œì ì˜ stateê°’ì´ ì•„ë‹Œ ë¹„ë™ê¸° ì½”ë“œê°€ ì˜ˆì•½ëœ ë‹¹ì‹œì˜ state ê°’ì´ ì‚¬ìš©ë˜ì–´ ë²„ê·¸ê°€ ë°œìƒí•œë‹¤.

ğŸ”½Â [`ì •ë‹µ ì½”ë“œ`]

```jsx
import { useState } from "react";

export default function RequestTracker() {
  const [pending, setPending] = useState(0);
  const [completed, setCompleted] = useState(0);

  async function handleClick() {
    setPending((p) => p + 1);
    await delay(3000);
    setPending((p) => p - 1);
    setCompleted((c) => c + 1);
  }

  return (
    <>
      <h3>Pending: {pending}</h3>
      <h3>Completed: {completed}</h3>
      <button onClick={handleClick}>Buy</button>
    </>
  );
}

function delay(ms) {
  return new Promise((resolve) => {
    setTimeout(resolve, ms);
  });
}
```

- ì •ë‹µì€ ì•„ë˜ì™€ ê°™ì´ `í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.

```jsx
setPending((p) => p + 1);
await delay(3000);
setPending((p) => p - 1);
setCompleted((c) => c + 1);
```

---

> ğŸ¤”Â ì²˜ìŒì— ëª¨í˜¸í–ˆë˜ ë¶€ë¶„ì€ `setCompleted((c) => c + 1)`ì´ì—ˆëŠ”ë°,, `setCompleted`ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ í•œë²ˆë§Œ ì‹¤í–‰í•˜ëŠ” ì½”ë“œì¸ë° ê¼­ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ ì¨ì•¼í• ê¹Œ? `setCompleted(completed + 1)` ì™€ ê°™ì´ ê°’ ê¸°ë°˜ ì—…ë°ì´íŠ¸ë„ ë˜‘ê°™ì´ ë™ì‘í•˜ì§€ ì•Šì„ê¹Œ?

ì´ë•ŒëŠ” í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ëŠ” í•˜ë‚˜ì˜ ë Œë”ë§ ì•ˆì—ì„œ (í•œ ê°€ì§€ ì¢…ë¥˜ì˜?)stateë¥¼ ì—°ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•œë‹¤ê³  ì´í•´í•´ì„œ, `setCompleted(c â‡’ c + 1)`ê³¼ ê°™ì€ ê²½ìš°ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ 1ë²ˆë§Œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œë‹ˆê¹Œ ì´ì „ ê°’ì„ ì°¸ì¡°í•  í•„ìš”ê°€ ì—†ë‹¤ê³  ìƒê°í–ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì—¬ê¸°ì„œë„ `setCompleted(c â‡’ c + 1)`ë¡œ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ í•´ì•¼ ì •í™•í•˜ê²Œ ë™ì‘í•˜ëŠ”ë° ì´ëŠ” ë¹„ë™ê¸° ì‘ì—… `await delay(3000)` ë•Œë¬¸ì´ë‹¤.

3ì´ˆ ì•ˆì— ì—°ì†ì ìœ¼ë¡œ 3ë²ˆì„ í´ë¦­í•œë‹¤ê³  í–ˆì„ ë•Œ ë™ì‘ ë°©ì‹ì€ ì•„ë˜ì™€ ê°™ë‹¤.

| ì‹œê°„(ms)     | ì´ë²¤íŠ¸                                                      |
| ------------ | ----------------------------------------------------------- |
| 0ms          | **ì²« ë²ˆì§¸ í´ë¦­** - pending +1 ì˜ˆì•½                          |
| 100ms        | **ë‘ ë²ˆì§¸ í´ë¦­** - pending +1 ì˜ˆì•½                          |
| 200ms        | **ì„¸ ë²ˆì§¸ í´ë¦­** - pending +1 ì˜ˆì•½                          |
| 0~200ms ë™ì•ˆ | ê° í´ë¦­ë§ˆë‹¤ `await delay(3000)`ì— ê±¸ë ¤ì„œ 3ì´ˆ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘    |
| 3000ms       | **ì²« ë²ˆì§¸ í´ë¦­**ì˜ 3ì´ˆ ì™„ë£Œ â†’ pending -1, completed +1 ì˜ˆì•½ |
| 3100ms       | **ë‘ ë²ˆì§¸ í´ë¦­**ì˜ 3ì´ˆ ì™„ë£Œ â†’ pending -1, completed +1 ì˜ˆì•½ |
| 3200ms       | **ì„¸ ë²ˆì§¸ í´ë¦­**ì˜ 3ì´ˆ ì™„ë£Œ â†’ pending -1, completed +1 ì˜ˆì•½ |

ë¦¬ë Œë”ë§ì´ ì™„ë£Œë˜ê¸° ì „ì— `handleClick`ì´ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œë˜ë©´, `completed + 1`ì€ í˜„ì¬ ë Œë”ë§ ì‹œì ì˜ `completed`ê°’(`0`)ë§Œ ê³„ì† ì°¸ì¡°í•˜ê²Œ ëœë‹¤. ê·¸ë˜ì„œ `setCompleted(completed + 1)`ì„ ì—°ì†í•´ì„œ í˜¸ì¶œí•´ë„ ëª¨ë‘ ì˜›ë‚  `0`ì„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í•´ë²„ë ¤ì„œ ì˜ˆìƒí•œ ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•ŠëŠ”ë‹¤.

ë°˜ë©´, í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸(`c â‡’ c + 1`)ë¥¼ ì‚¬ìš©í•˜ë©´, ê°€ì¥ ìµœì‹ ì˜ `state`ë¥¼ ë§¤ë²ˆ ë°›ì•„ì„œ ì—…ë°ì´íŠ¸í•˜ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ ë²ˆ ë¹„ë™ê¸°ì ìœ¼ë¡œ í˜¸ì¶œë¼ë„ ì •í™•í•˜ê²Œ ê°’ì´ ëˆ„ì ëœë‹¤.

â‡’ ë”°ë¼ì„œ ë¹„ë™ê¸° ì‘ì—… ì¤‘ `state`ë¥¼ ì—…ë°ì´íŠ¸í•  ë•ŒëŠ” **í•­ìƒ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤**.

---

> ğŸ¤”Â ì—¬ê¸°ì„œ í•´ê²°ë˜ì§€ ì•Šì€ ì˜ë¬¸ì  2
> **ë¦¬ì•¡íŠ¸ì˜ ë°°ì¹­ì²˜ë¦¬ì— ë”°ë¥´ë©´ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ëª¨ë‘ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦° ë‹¤ìŒì— í•œ ë²ˆì— state ì—…ë°ì´íŠ¸ë¥¼ ì²˜ë¦¬í•´ì„œ ë¦¬ë Œë”ë§ì„ ìš”ì²­**í•œë‹¤ê³  í•˜ëŠ”ë°, ì–´ë–»ê²Œ í´ë¦­ê³¼ ë™ì‹œì—(= `await delay(3000)` í›„ì˜ ì½”ë“œê°€ ì‹¤í–‰ë˜ê¸° ì „ì—) í™”ë©´ì—ì„œ `pending` ê°’ì´ `0 â†’ 1 â†’ 2 â†’ 3` **ì¦‰ê°ì ìœ¼ë¡œ ë³€í•œê±¸ê¹Œ?**

```jsx
async function handleClick() {
  setPending((p) => p + 1); // (1) pending +1 ì˜ˆì•½
  await delay(3000); // (2) 3ì´ˆ ê¸°ë‹¤ë¦¬ê¸° (ì—¬ê¸°ì„œ "ë©ˆì¶¤")
  setPending((p) => p - 1); // (3) 3ì´ˆ ë’¤ì— ì‹¤í–‰
  setCompleted((c) => c + 1); // (4) 3ì´ˆ ë’¤ì— ì‹¤í–‰
}
```

- `setPending(p â‡’ p + 1)`ì„ í˜¸ì¶œí•˜ë©´ ê³§ë°”ë¡œ `pending` state ì—…ë°ì´íŠ¸ë¥¼ ì˜ˆì•½
- í•¸ë“¤ëŸ¬ í•¨ìˆ˜ê°€ `await delay(3000)`ì„ ë§Œë‚˜ë©´ì„œ **ì¼ì‹œì •ì§€**ë¨
- â‡’ ë¦¬ì•¡íŠ¸ëŠ” í˜„ì¬ë¡œì„œ ë” ì´ìƒ ì‹¤í–‰í•  ì½”ë“œê°€ ì—†ë‹¤ê³  íŒë‹¨í•˜ê³  **ë¦¬ë Œë”ë§ì„ ìš”ì²­**í•¨
- 3ì´ˆ í›„, ë‚¨ì€ ì½”ë“œë¥¼ ì´ì–´ì„œ ì‹¤í–‰(ì´ë•Œ `setPending((p) => p - 1)`ì™€ `setCompleted((c) => c + 1)`ì€ ë°°ì¹­ì²˜ë¦¬ë˜ì–´ í•œë²ˆì— ì²˜ë¦¬ë¨) => **ë‹¤ì‹œ ë Œë”ë§**

ê°„ë‹¨íˆ ë¹„ìœ í•˜ìë©´,

- `await`ê°€ ì—†ìœ¼ë©´:
  â†’ "ì†ë‹˜ ì£¼ë¬¸ ë‹¤ ë°›ì„ ë•Œê¹Œì§€ ì„œë¹™ ì•ˆ í•¨."
- `await`ê°€ ìˆìœ¼ë©´:
  â†’ "ì£¼ë¬¸ í•˜ë‚˜ ë°›ê³  ì ê¹ ì„œë¹™í•˜ê³ , ë‹¤ì‹œ ëŒì•„ì™€ì„œ ë‚˜ë¨¸ì§€ ì£¼ë¬¸ ë°›ìŒ."

## âœ¨ê²°ë¡ 

```jsx
function handleClick() {
  setPending((p) => p + 1);
  setPending((p) => p - 1);
  setCompleted(completed + 1);
}
```

- ë§Œì•½ ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ” ì½”ë“œê°€ ì•„ë‹ˆë¼ë©´ `setCompleted(completed + 1)`ëŠ” í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šë”ë¼ë„ `handleClick` ë‚´ ì½”ë“œê°€ ë‹¤ ì‹¤í–‰ëœ í›„ ë¦¬ë Œë”ë§ ë•Œ í•œë²ˆì— ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ì—†ì„ ê²ƒì´ë‹¤.
- ì—¬ì „íˆ `pending`ì€ ëˆ„ì ëœ ê°’ì„ ì²˜ë¦¬í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼í•˜ê³ , ë‹¤ë§Œ ì´ ê²½ìš°ì—ëŠ” ë°°ì¹­ì²˜ë¦¬ë¡œ í™”ë©´ìƒì—ì„œëŠ” `0 -> 1 -> 0` ìœ¼ë¡œ ìˆ«ì ë³€í™”ê°€ ë³´ì´ì§€ ì•Šê³  `0`ìœ¼ë¡œ ë³€í™”ê°€ ì—†ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì¼ ê²ƒì´ë‹¤.

```jsx
async function handleClick() {
  setPending((p) => p + 1);
  await delay(3000);
  setPending((p) => p - 1);
  setCompleted((c) => c + 1);
}
```

- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì— ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ” ì½”ë“œê°€ ìˆë‹¤ë©´ ë¹„ë™ê¸° ì½”ë“œë¥¼ ë§Œë‚˜ ì¼ì‹œì •ì§€ê°€ ì¼ì–´ë‚˜ê¸° ì „ê¹Œì§€ ì˜ˆì•½ëœ `state` ì—…ë°ì´íŠ¸ë“¤ì€ ë¨¼ì € ì²˜ë¦¬ê°€ ë˜ê³ (ë°°ì¹­ ì²˜ë¦¬ ê¹¨ì§) ì¼ì‹œì •ì§€ê°€ í’€ë¦° ì´í›„ì˜ `state` ì—…ë°ì´íŠ¸ë“¤ë„ í•œë²ˆì— ë°°ì¹­ ì²˜ë¦¬ê°€ ë˜ì–´ ë¦¬ë Œë”ë§ì´ ë˜ë©° ì²˜ë¦¬ê°€ ë  ê²ƒì´ë‹¤. ì£¼ì˜í•  ì ì€ ì¼ì‹œì •ì§€ê°€ í’€ë¦° ì´í›„ ì—…ë°ì´íŠ¸ ë˜ëŠ” `state`ë“¤ë„ ì˜ˆì•½ëœ ë‹¹ì‹œì˜ `state`ê°’ì„ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— ì´ë ‡ê²Œ ë¹„ë™ê¸°ë¡œ ì‘ë™í•˜ëŠ” ì½”ë“œë“¤ì€ í•­ìƒ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤.

> **state ì—…ë°ì´íŠ¸ê°€ ì´ì „ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ëˆ„ì ë˜ì–´ì•¼ í•˜ê±°ë‚˜, ë¹„ë™ê¸° íë¦„ì—ì„œ ì°¸ì¡°ë˜ëŠ” ê²½ìš°ì—ëŠ” ë°˜ë“œì‹œ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.**
